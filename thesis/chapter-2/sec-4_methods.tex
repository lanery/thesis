\section{Material \& methods}
\label{sec:2.4_methods}

% 2.4.1
% -----
\subsection{Modeling}
\label{sec:2.4.1_modeling}

All simulations were performed in Electron Optical Design (EOD) \cite{lencova2008new}. Descriptions of how the simulations were carried out are provided in the main text. The angular distribution of signal electrons generated by a beam of primary electrons at a normal incident angle can be approximated by Lambert's cosine law \cite{reimer1998emission}. The probability of sampling a ray with angle $\theta$ to the normal of the surface is then proportional to $\cos\theta \sin\theta = \sin 2\theta$. If $\boldsymbol{U}$ is a random uniform distribution between 0 and 1, then
%
\begin{align}
    \int_0^\theta \sin \left( 2\theta \right) d\theta &= \boldsymbol{U} \\
    \theta &= \cos^{-1} \left( \sqrt{\boldsymbol{U}} \right)
\end{align}
%
from which the initial angle of a signal electron can be chosen at random for use in simulations.


% 2.4.2
% -----
\subsection{Tissue and sample preparation}
\label{sec:2.4.2_sampleprep}

Fixed rat pancreas tissue were post fixed for \SI{2}{\hour} in 1\% osmiumtetroxide and 1.5\% potassium ferrocyanide in \SI{0.1}{\molar} cacodylate for \SI{2}{\hour} at \SI{4}{\celsius}. Followed by dehydration in a graded series of ethanol and finally embedded in EPON. Ultrathin section of \SI{80}{\nano\meter} were cut and placed on ITO glass. Sections were blocked for \SI{30}{\minute} with 1\% bovine serum albumin (BSA; Sanquin, The Netherlands) in tris-buffered saline (TBS), pH 7.4. Next, anti-insulin (guinea pig; 1:50 in 1\% BSA/TBS) was incubated for \SI{2}{\hour}, followed by three washes of \SI{5}{\minute} with TBS and subsequent incubation for \SI{1}{\hour} with biotinylated secondary antibody (donkey-anti-guinea pig; 1:400 in 1\% BSA/TBS, Jackson Immunoresearch, UK) followed by three washes in TBS. Finally, streptavidin conjugated Alexa594 (1:200, in 1\% BSA/TBS, Life Technologies) was added for \SI{1}{\hour} followed by three washes in TBS and two with MilliQ water. Hoechst staining was performed for \SI{10}{\minute} followed by a washing step with MilliQ water.

HeLa cells were cultured in a \SI{37}{\celsius}, 5\% CO2 incubator, in T75 culture bottles (Corning). Cells were maintained in Dulbecco’s Modified Eagle’s Medium (DMEM; Gibco) supplemented with 10\% fetal bovine serum, \SI{2}{\milli\molar} L-glutamin, \SI{100}{U\per\milli\liter} penicillin, \SI{100}{\milli\gram\per\milli\liter} streptomycin (referred to as complete DMEM). Cells were passaged when confluency reached 85\% to 90\% were grown in \SI{6}{\centi\meter} dishes. Cells were incubated for \SI{3}{\hour} with endocytic fiducial markers at a concentration of \SI{1}{\milli\gram\per\milli\liter} dissolved in complete DMEM, rinsed, and then fixed with 2.5\% glutaralhedyde + 2\% formaldehyde in \SI{0.1}{\molar} Phosphate buffer. Fixed HeLa cells were scraped, embedded in agarose and prepared for electron microscopy according to the protocol described in \cite{fokkema2018fluorescently} with minor modifications. Briefly, samples were postfixed using 1\% osmium tetroxide (w/v) with 1.5\% potassium ferrocyanide (w/v) for \SI{1}{\hour} on ice, and stained with 2\% uranyl acetate in dH2O for \SI{30}{\minute}. Dehydration was performed using a graded ethanol series. Samples were embedded in EPON resin and polymerized for \SIrange{48}{60}{\hour} at \SI{65}{\celsius}. Ultrathin sections of \SI{100}{\nano\meter} were cut using a microtome (Leica, U67) and placed on ITO glass. Hoechst staining was performed for \SI{120}{\minute} followed by a washing step with MilliQ water, and air dried.


% 2.4.3
% -----
\subsection{Signal-to-noise ratio measurements}
\label{sec:3.4.3_snr}

The SNR is calculated by averaging the spectral signal-to-noise ratio (SSNR) \cite{unser1987new} over the full frequency space of the set of input images. Here, the input images are composed of alternating scan lines from individual images acquired with a pixel size on par with the resolution of the electron beam. The SSNR is given by
%
\begin{equation}
    SSNR(R) = \frac{\sum_{r \in R} \Bigl \lvert \sum_k F_k(r) \Bigr \rvert ^2}{\frac{K}{K-1} \sum_{r \in R} \sum_k \Bigl \lvert F_k(r) - \bar{F}(r) \Bigr \rvert ^2} - 1
\end{equation}
%
where $F_k(r)$ is the Fourier transform of the $k^{\text{th}}$ image, there are $K$ images in total, $\overline{F}=\frac{1}{k}\Sigma_k F_k(r)$ is the mean of the Fourier transformed images, and $R$ is the region of interest. A single SNR value for the entire image (Figure \ref{fig:2.4_snr}; Figure \ref{fig:2.S2_comparison}) is obtained when $R$ is the full image; when spectrally resolved (bottom row of Figure \ref{fig:2.5_noise}), $R$ is a ring in Fourier space.

Additional SNR measurements based on a cross-correlation approach presented in \textcite{joy2002smart} were made to verify the SSNR-based calculations. In this approach, the SNR is calculated from computing the cross-correlation coefficient, $R_n$, between successive scan lines, $I_i$ and $I_{i+1}$, of individual EM images. The cross-correlation coefficient is given by
%
\begin{equation}
    R_n = \frac{\text{cov} \left(I_i, I_{i+1}\right)}{\text{var} \left(I_i\right) \text{var} \left(I_{i+1}\right)}
\end{equation}
%
The signal-to-noise ratio is then calculated from
%
\begin{equation}
    SNR = \frac{R_n}{1-R_n}
\end{equation}
%
% TODO: include code?
% The code used for computing both SNR methods is provided in Appendix \ref{}.


% 2.4.4
% -----
\subsection{Integrated microscopy workflow}
\label{sec:2.4.4_workflow}

Fluorescence microscopy was done in the integrated microscope via the SECOM (Delmic B.V.), which has been retrofitted into the vacuum chamber of a Verios 460 SEM (Thermo Fisher Scientific) such that the two microscopes share a common sample stage and optical axis \cite{liv2013simultaneous, zonnevylle2013integration}. With this configuration we are able to achieve high overlay precision without a reliance on fiducial markers or manual input \cite{haring2017automated}. The SECOM was equipped with a CFI S Plan Fluor ELWD 60XC microscope objective (Nikon), which was chosen for its high magnification in combination with an extra-long working distance (\SIrange{2.60}{1.80}{\milli\meter}). This lens enabled greater bias potentials to be reached without risking electrical breakdown in vacuum—at the cost of a somewhat lower numerical aperture (\SI{0.70}{NA}). Each FM image was comprised of two \SI{5}{\second} exposures: (1) \SI{555}{\nano\meter} excitation for Alexa 594 labelling of insulin and (2) \SI{405}{\nano\meter} excitation for the Hoechst counterstain.

An overview of imaging conditions is provided in Table \ref{table:2.4_params}. Fluorescence microscopy image tiles were acquired in a 4 $\times$ 3 grid encompassing the tissue section. Low-magnification EM images of the same (but slightly smaller) field of view were acquired immediately following the acquisition of each FM image tile. An automated alignment procedure was then executed to register each set of FM and EM image pairs \cite{haring2017automated}. The information necessary for registration was stored in the metadata of the image tiles for use in post-processing (Section \ref{sec:2.4.5_reconstruction}). The stage was then translated by \SI{170}{\micro\meter} such that the FM images overlapped by a significant margin, whereas the low-magnification EM tiles did not. This was done to prevent damage to the FM tiles due to e-beam irradiation. Following low-magnification CLEM, a 40 $\times$ 30 grid of high-magnification EM image tiles was acquired over the section. Each image was acquired in immersion mode at \SI{3}{\kilo\electronvolt} primary beam energy with a \SI{-1.5}{\kilo\volt} bias applied to the stage, resulting in a \SI{1.5}{\kilo\electronvolt} landing energy. Of the 1200 high-magnification EM images acquired, 113 were discarded as they consisted of only either EPON or the substrate.
%
\begin{table}[!tbh]
    \centering
    \caption{Imaging parameters used for the full-section acquisition of \SI{80}{\nano\meter} rat pancreas tissue via the integrated light-electron microscope.}
    \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}llll@{}}
    \toprule
    & \textbf{FM} & \textbf{EM (Low-mag)} & \textbf{EM (High-mag)} \\ \midrule
    Resolution    & 107.8 nm/px & 38.8 nm/px            & 4.86 nm/px             \\
    Dwell         &             & 5 μs                  & 2 μs                   \\
    Exposure      & 5 s         &                       &                        \\
    Field of View & 220 μm      & 160 μm                & 20 μm                  \\ \bottomrule
    \end{tabular*}
    \label{table:2.4_params}
\end{table}


% 2.4.5
% -----
\subsection{Reconstruction}
\label{sec:2.4.5_reconstruction}

Following image acquisition, EM images were post-processed with histogram matching to correct for variations in intensity thought to have arisen from electron source drift during acquisition (variation in the bias potential delivered by the external power supply was negligible). No corrections were performed on the FM images. FM and EM image dataset was then uploaded to a local server running an instance of render-ws.\footnote{\href{https://github.com/saalfeldlab/render}{https://github.com/saalfeldlab/render}} EM images were stitched together using the method presented in \textcite{khairy2018joint}. The correlative overlay between the FM and low magnification EM image tiles was done using the registration metadata collected at time of acquisition as described in Section \ref{sec:2.4.4_workflow}.

The process of correlating the FM and stitched, high-magnification EM image tiles consisted of several steps. First, for each low-magnification EM tile, the set of overlapping high mag EM tiles was found. A composite image of the overlapping tiles was then rendered and processed with SIFT to find corresponding point matches with the low mag EM tile \cite{lowe1999object}. An affine transformation was then computed for this set of features and propagated to the FM tiles such that they overlaid precisely with the stitched together, high mag EM image tiles. The entire sequence of post-processing steps is compiled in a series of jupyter notebooks available in an online repository.\footnote{\href{https://github.com/hoogenboom-group/iCAT-workflow}{https://github.com/hoogenboom-group/iCAT-workflow}}

Small 1024 $\times$ \SI{1024}{\pixel^2} images of the reconstructed dataset are then rendered and exported in a pyramidal format for visualization with CATMAID \cite{saalfeld2009catmaid}. Within CATMAID, the FM images are given a false color transformation and the EM images are contrast-inverted for visualization purposes.
